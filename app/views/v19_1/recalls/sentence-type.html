{% extends "../../includes/layouts/template-linear.html" %}
{% block content %}
<!-- Back link -->
<div class="moj-width-container">
  <a href="update-sentence-types" class="govuk-back-link">Back</a>
</div>

<div class="govuk-grid-row govuk-!-margin-top-4">
  <div class="govuk-grid-column-two-thirds">

    {# Get offence code from session #}
    {% set offenceCode = data['sentenceUpdated'] %}

    {# Find selected sentence and court case #}
    {% set selectedSentence = null %}
    {% set selectedCourtCase = null %}
    {% set selectedAppearance = null %}
    {% for courtCase in data.courtCases %}
      {% for appearance in courtCase.appearances %}
        {% for sentence in appearance.sentences %}
          {% if sentence['offence-code'] == offenceCode %}
            {% set selectedSentence = sentence %}
            {% set selectedCourtCase = courtCase %}
            {% set selectedAppearance = appearance %}
          {% endif %}
        {% endfor %}
      {% endfor %}
    {% endfor %}

    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
          <h1 class="govuk-fieldset__heading">
            <span class="govuk-caption-l">Record a recall</span>
            Select the sentence type
          </h1>
        </legend>

        {% if selectedSentence %}
          <p class="govuk-body-l">{{ selectedSentence['offence-name'] }}</p>
        {% else %}
          <p class="govuk-body">No offence found for code {{ offenceCode }}.</p>
        {% endif %}

        <div class="govuk-radios" data-module="govuk-radios">
          {% set typeOptions = [
            "SDS (Standard Determinate Sentence)",
            "EDS (Extended Determinate Sentence)",
            "SOPC (offenders of a particular concern)",
            "ORA SDS (Offender rehabilitation act standard determinate sentence)",
            "Automatic life",
            "BOTUS (Breach of top up supervision)",
            "Adult discretionary life",
            "Adult mandatory life",
            "STS (Serious terrorism sentence)",
            "VOO (Violent offender order)",
            "Civil imprisonment",
            "Imprisonment in default of a fine"
          ] %}

          {% for option in typeOptions %}
            {% set optionId = "sentence-type-" + loop.index %}
            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="{{ optionId }}" name="sentence[sentence-type]" type="radio" value="{{ option }}"
                {% if data.sentence['sentence-type'] == option %} checked {% endif %}>
              <label class="govuk-label govuk-radios__label" for="{{ optionId }}">
                {{ option }}
              </label>

              {% if option == "SOPC (offenders of a particular concern)" %}
                <div id="sopc-hint" class="govuk-hint govuk-radios__hint">
                  A mandatory licence period of 12 months will automatically be added to the sentence
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </fieldset>
    </div>

    <form class="form" action="/v19_1/recalls/update-sentence-types" method="post">
      <input type="hidden" name="{{ offenceCode }}" value="updated">
      <div class="govuk-button-group">
        <button type="submit" class="govuk-button" data-module="govuk-button">
          Continue
        </button>
        <button class="govuk-button govuk-button--secondary" data-module="govuk-button"
          formaction="#" method="post">
          Cancel
        </button>
      </div>
    </form>

  </div>

  <div class="govuk-grid-column-one-third">

    <div class="offence-summary">
      <h2 class="govuk-heading-m govuk-!-margin-top-4">Court case details</h2>
      <dl class="govuk-summary-list govuk-summary-list--no-border offences-summary-card-content">
  
        <div class="govuk-summary-list__row offences-summary-card-court-details-row">
          <dt class="govuk-summary-list__key">Case reference</dt>
          <dd class="govuk-summary-list__value">{{ selectedAppearance['court-case-ref'] }}</dd>
        </div>
  
        <div class="govuk-summary-list__row offences-summary-card-court-details-row">
          <dt class="govuk-summary-list__key">Court name</dt>
          <dd class="govuk-summary-list__value">{{ selectedAppearance['court-name'] }}</dd>
        </div>
  
        <div class="govuk-summary-list__row offences-summary-card-court-details-row">
          <dt class="govuk-summary-list__key">Warrant date</dt>
          <dd class="govuk-summary-list__value">
            {{ selectedAppearance['warrant-date-day'] }}/{{ selectedAppearance['warrant-date-month'] }}/{{ selectedAppearance['warrant-date-year'] }}
          </dd>
        </div> 
  
      </dl>
    </div>
  
  </div>
  
</div>
{% endblock %}
